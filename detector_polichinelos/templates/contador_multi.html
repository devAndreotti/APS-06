<!DOCTYPE html>
<html lang="pt-br">
<head>
  <!-- Meta tags básicas -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detector de Polichinelos - Múltiplas Pessoas</title>
  
  <!-- Estilos CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='contador.css') }}">
</head>
<body class="fullscreen multi-mode">

  <!-- Seção de vídeo em tela cheia para múltiplas pessoas -->
  <div class="fullscreen-video">
      <img src="{{ url_for('video_feed_multi') }}" 
          alt="Stream da câmera" 
          class="video-stream">
  </div>

  <!-- Cards de dados flutuantes em tempo real -->
  <div class="floating-data-cards">
      <!-- Botões primeiro -->
      <div class="floating-btn-container">
        <!-- Botão voltar para página inicial -->
        <a href="/" class="floating-btn btn-back">
          <img src="{{ url_for('static', filename='images/icons/arrow-left.svg') }}" alt="Back" class="lucide-icon">
        </a>
        <!-- Botão para alternar modo (2 pessoas / 1 pessoa) -->
        <form action="{{ url_for('toggle_mode') }}" method="POST">
          <input type="hidden" name="current_mode" value="2">
          <button type="submit" class="floating-btn btn-back">
            <img src="{{ url_for('static', filename='images/icons/user.svg') }}" alt="User" class="lucide-icon">
          </button>
        </form>
      </div>
      <!-- Card principal de monitoramento -->
      <div class="main-data-card glass">
        <div class="card-header">
          <h3>Dados em Tempo Real</h3>
          <div class="status-indicator" id="statusIndicator">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Conectando...</span>
          </div>
        </div>
        <!-- Container dinâmico para dados das pessoas detectadas -->
        <div id="pessoas-container" class="data-grid">
          <!-- Pessoa 1 -->
          <div class="data-item" id="pessoa-1">
            <div class="data-icon">
              <img src="{{ url_for('static', filename='images/icons/user.svg') }}" alt="User" class="lucide-icon">
            </div>
            <div class="data-content">
              <div class="data-value">Pessoa 1</div>
              <div class="data-label" id="jumps-1">Polichinelos: 0</div>
              <div class="data-label" id="fps-1">FPS: 0</div>
            </div>
          </div>
          <!-- Pessoa 2 -->
          <div class="data-item" id="pessoa-2">
            <div class="data-icon">
              <img src="{{ url_for('static', filename='images/icons/user.svg') }}" alt="User" class="lucide-icon">
            </div>
            <div class="data-content">
              <div class="data-value">Pessoa 2</div>
              <div class="data-label" id="jumps-2">Polichinelos: 0</div>
              <div class="data-label" id="fps-2">FPS: 0</div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- Instruções flutuantes para múltiplas pessoas -->
  <div class="floating-instructions">
    <div class="instructions-content">
      <h3>Instruções</h3>
      <ul>
        <li>Posicione-se em frente à câmera</li>
        <li>Mantenha o corpo todo visível</li>
        <li>Execute os polichinelos de forma clara</li>
      </ul>
    </div>
  </div>

  <!-- Scripts JavaScript -->
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    // Resetar dados ao carregar a página
    fetch('/reset_multi', { method: 'POST' }).catch(() => {});

    // Resetar dados quando a página perde o foco (usuário sai da aba)
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        fetch('/reset_multi', { method: 'POST' }).catch(() => {});
      }
    });

    // Função para atualizar dados das pessoas detectadas
    async function atualizarDados() {
      try {
        const response = await fetch('/api/data_multi');
        const data = await response.json();

        // Atualizar status do sistema usando a mesma função de script.js
        updateConnectionStatus(true);

        // Atualizar dados das pessoas (os cards já existem no HTML)
        if (data.pessoas && data.pessoas.length > 0) {
          data.pessoas.forEach((pessoa, index) => {
            const pessoaIndex = index + 1;
            const jumpsElement = document.getElementById(`jumps-${pessoaIndex}`);
            const fpsElement = document.getElementById(`fps-${pessoaIndex}`);
            
            if (jumpsElement) {
              jumpsElement.textContent = `Polichinelos: ${pessoa.jumps || 0}`;
            }
            if (fpsElement) {
              fpsElement.textContent = `FPS: ${pessoa.fps || 0}`;
            }
          });
        }

      } catch (err) {
        console.error('Erro ao buscar dados:', err);
        // Atualizar status para desconectado em caso de erro
        updateConnectionStatus(false);
      }
    }

    // Atualizar dados imediatamente e depois a cada segundo
    atualizarDados();
    setInterval(atualizarDados, 1000);
  </script>
</body>
</html>
