<!DOCTYPE html>
<html lang="pt-br">
<head>
  <!-- Meta tags básicas -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detector de Polichinelos - Múltiplas Pessoas</title>
  
  <!-- Estilos CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='contador.css') }}">
</head>
<body class="fullscreen">

  <!-- Seção de vídeo em tela cheia para múltiplas pessoas -->
  <div class="fullscreen-video">
      <img src="{{ url_for('video_feed_multi') }}" 
          alt="Stream da câmera" 
          class="video-stream">
  </div>

  <!-- Cards de dados flutuantes em tempo real -->
  <div class="floating-data-cards">

    <!-- Card principal de monitoramento -->
    <div class="main-data-card glass">
      <div class="card-header">
        <h3>Dados em Tempo Real</h3>
        <div class="status-indicator" id="statusIndicator">
          <div class="status-dot" id="statusDot"></div>
          <span id="statusText">Conectando...</span>
        </div>
      </div>

      <!-- Container dinâmico para dados das pessoas detectadas -->
      <div id="pessoas-container" class="data-grid">
        <!-- As pessoas detectadas serão inseridas aqui dinamicamente via JavaScript -->
      </div>
    </div>

    <!-- Container de botões de controle -->
    <div class="floating-btn-container">
      
      <!-- Botão voltar para página inicial -->
      <a href="/" class="floating-btn btn-back">
        <img src="{{ url_for('static', filename='images/icons/arrow-left.svg') }}" alt="Back" class="lucide-icon">
        Voltar
      </a>
      
      <!-- Botão para alternar modo (2 pessoas / 1 pessoa) -->
      <form action="{{ url_for('toggle_mode') }}" method="POST">
        <input type="hidden" name="current_mode" value="2">
        <button type="submit" class="floating-btn btn-back">
          <img src="{{ url_for('static', filename='images/icons/user.svg') }}" alt="User" class="lucide-icon">
          1 Pessoa
        </button>
      </form>
      
    </div>
  </div>

  <!-- Instruções flutuantes para múltiplas pessoas -->
  <div class="floating-instructions">
    <div class="instructions-content">
      <h3>Instruções</h3>
      <ul>
        <li>Posicione-se em frente à câmera</li>
        <li>Mantenha o corpo todo visível</li>
        <li>Execute os polichinelos de forma clara</li>
      </ul>
    </div>
  </div>

  <!-- Scripts JavaScript -->
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    // Resetar dados ao carregar a página
    fetch('/reset_multi', { method: 'POST' }).catch(() => {});

    // Resetar dados quando a página perde o foco (usuário sai da aba)
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        fetch('/reset_multi', { method: 'POST' }).catch(() => {});
      }
    });

    // Função para atualizar dados das pessoas detectadas
    async function atualizarDados() {
      try {
        const response = await fetch('/api/data_multi');
        const data = await response.json();

        // Atualizar status do sistema
        const statusText = document.getElementById('statusText');
        const statusDot = document.getElementById('statusDot');
        statusText.textContent = data.stage || 'Desconhecido';
        statusDot.style.background = data.stage === 'Contando' ? '#00ff66' : '#ffaa00';

        // Atualizar container de pessoas
        const container = document.getElementById('pessoas-container');
        container.innerHTML = '';

        if (data.pessoas && data.pessoas.length > 0) {
          // Criar cards para cada pessoa detectada
          data.pessoas.forEach((pessoa, index) => {
            const pessoaCard = document.createElement('div');
            pessoaCard.classList.add('data-item');
            pessoaCard.innerHTML = `
              <div class="data-icon">
                <img src="{{ url_for('static', filename='images/icons/user.svg') }}" alt="User" class="lucide-icon">
              </div>
              <div class="data-content">
                <div class="data-value">Pessoa ${index + 1}</div>
                <div class="data-label">Polichinelos: ${pessoa.jumps}</div>
                <div class="data-label">FPS: ${pessoa.fps}</div>
              </div>
            `;
            container.appendChild(pessoaCard);
          });
        } else {
          container.innerHTML = `<p>Nenhuma pessoa detectada</p>`;
        }

      } catch (err) {
        console.error('Erro ao buscar dados:', err);
      }
    }

    // Atualizar dados a cada segundo
    setInterval(atualizarDados, 1000);
  </script>
</body>
</html>
